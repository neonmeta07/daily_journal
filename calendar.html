<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Calendar</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Indie+Flower&family=Pacifico&family=Quicksand&family=Sacramento&family=Shadows+Into+Light&family=Caveat&family=Kalam&family=Satisfy&family=Comic+Neue&display=swap" rel="stylesheet">
    <!-- Font Awesome for cute icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
    /* Base Styles */
    :root {
        /* Soft Pink & Cream Theme (default) */
        --background: #fff5f7;
        --sidebar-bg: #f8e1e5;
        --paper-bg: #fffaf0;
        --text-color: #5d4037;
        --accent-color: #e57373;
        --border-color: #d7ccc8;
        --shadow-color: rgba(93, 64, 55, 0.2);
        --doodle-color: #f48fb1;
        --entry-bg: #fff9f9;
        --today-bg: rgba(229, 115, 115, 0.3);
        --event-bg: #fff5f5;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Quicksand', sans-serif;
        background-color: var(--background);
        color: var(--text-color);
        line-height: 1.6;
        transition: all 0.3s ease;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Header Styles */
    header {
        text-align: center;
        margin-bottom: 30px;
    }

    header h1 {
        font-family: 'Dancing Script', cursive;
        font-size: 3rem;
        color: var(--accent-color);
        margin-bottom: 5px;
        text-shadow: 2px 2px 3px var(--shadow-color);
    }

    #date {
        font-size: 1rem;
        color: var(--text-color);
        font-style: italic;
    }

    /* Main Layout */
    main {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }

    /* Sidebar Styles */
    .sidebar {
        flex: 0 0 250px;
        background-color: var(--sidebar-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 8px var(--shadow-color);
        transition: all 0.3s ease;
    }

    .sidebar-section {
        margin-bottom: 25px;
    }

    .sidebar-section h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 5px;
    }

    /* Theme Options */
    .theme-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .theme-option {
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .theme-option input {
        margin-right: 10px;
    }

    .theme-preview {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 10px;
        border: 1px solid var(--border-color);
    }

    .custom-select {
        width: 100%;
        padding: 8px 12px;
        border-radius: 20px;
        border: 1px solid var(--border-color);
        background-color: var(--sidebar-bg);
        color: var(--text-color);
        font-size: 14px;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238b5a4c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
    }

    /* Calendar Container */
    .calendar-container {
        flex: 1;
        min-width: 300px;
        background-color: var(--paper-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px var(--shadow-color);
    }

    /* Calendar Header */
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .month-navigation {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .month-navigation h2 {
        font-family: 'Dancing Script', cursive;
        font-size: 1.8rem;
        color: var(--accent-color);
        min-width: 200px;
        text-align: center;
    }

    .nav-btn {
        background-color: var(--sidebar-bg);
        border: 2px solid var(--accent-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-color);
    }

    .nav-btn:hover {
        background-color: var(--accent-color);
        color: white;
        transform: scale(1.1);
    }

    .date-jump {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    #date-picker {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        background-color: var(--sidebar-bg);
        color: var(--text-color);
        font-family: inherit;
    }

    .action-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px var(--shadow-color);
    }

    #today-btn {
        background-color: var(--sidebar-bg);
        color: var(--text-color);
    }

    #today-btn:hover {
        background-color: var(--accent-color);
        color: white;
    }

    #add-event-btn {
        background-color: var(--accent-color);
        color: white;
    }

    #add-event-btn:hover {
        background-color: var(--sidebar-bg);
        color: var(--text-color);
    }

    /* Calendar Grid */
    .calendar-grid {
        width: 100%;
    }

    .weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        font-weight: 600;
        padding: 10px 0;
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 10px;
    }

    .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
    }

    .day {
        background-color: var(--entry-bg);
        border-radius: 10px;
        padding: 10px;
        min-height: 100px;
        display: flex;
        flex-direction: column;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px var(--shadow-color);
    }

    .day:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px var(--shadow-color);
    }

    .day.today {
        background-color: var(--today-bg);
        border: 2px solid var(--accent-color);
    }

    .day.other-month {
        opacity: 0.5;
    }

    .day-number {
        font-weight: 600;
        margin-bottom: 5px;
        text-align: right;
    }

    .today .day-number {
        color: var(--accent-color);
        font-weight: 700;
    }

    .events-container {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .event {
        padding: 5px;
        border-radius: 5px;
        font-size: 0.8rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: var(--event-bg);
        box-shadow: 0 1px 3px var(--shadow-color);
    }

    .event:hover {
        transform: translateX(3px);
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10;
        justify-content: center;
        align-items: center;
    }

    .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background-color: var(--paper-bg);
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px var(--shadow-color);
        overflow: hidden;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 2px solid var(--border-color);
    }

    .modal-header h3 {
        font-family: 'Dancing Script', cursive;
        color: var(--accent-color);
        font-size: 1.5rem;
    }

    .close-btn {
        background: transparent;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-color);
        transition: all 0.2s ease;
    }

    .close-btn:hover {
        color: var(--accent-color);
        transform: scale(1.1);
    }

    #event-form {
        padding: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"] {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        font-family: inherit;
        background-color: var(--entry-bg);
        color: var(--text-color);
        transition: all 0.3s ease;
    }

    input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px rgba(229, 115, 115, 0.3);
    }

    .color-options {
        display: flex;
        gap: 15px;
        margin-top: 10px;
    }

    input[type="radio"] {
        display: none;
    }

    .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 3px solid transparent;
    }

    input[type="radio"]:checked + .color-option {
        border-color: var(--text-color);
        transform: scale(1.1);
    }

    .form-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }

    .form-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px var(--shadow-color);
    }

    #save-event {
        background-color: var(--accent-color);
        color: white;
    }

    #save-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow-color);
    }

    #delete-event {
        background-color: #e57373;
        color: white;
    }

    #delete-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow-color);
    }

    .hidden {
        display: none;
    }

    /* Event Preview */
    .event-preview {
        position: absolute;
        background-color: var(--paper-bg);
        border-radius: 10px;
        box-shadow: 0 5px 15px var(--shadow-color);
        width: 250px;
        z-index: 5;
        display: none;
        overflow: hidden;
        animation: fadeIn 0.2s ease;
    }

    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
    }

    .preview-header h4 {
        font-family: 'Dancing Script', cursive;
        color: var(--accent-color);
        font-size: 1.2rem;
        margin: 0;
    }

    .preview-content {
        padding: 15px;
    }

    .preview-content p {
        margin: 0;
        color: var(--text-color);
    }

    .preview-actions {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        border-top: 1px solid var(--border-color);
    }

    .preview-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px var(--shadow-color);
    }

    #edit-event {
        background-color: var(--sidebar-bg);
        color: var(--text-color);
    }

    #edit-event:hover {
        background-color: var(--accent-color);
        color: white;
    }

    #preview-delete {
        background-color: #e57373;
        color: white;
    }

    #preview-delete:hover {
        background-color: #d32f2f;
    }

    /* Decorative Elements */
    .corner-doodle {
        position: absolute;
        width: 40px;
        height: 40px;
        opacity: 0.6;
        z-index: 1;
    }

    .top-left {
        top: 5px;
        left: 5px;
    }

    .top-right {
        top: 5px;
        right: 5px;
    }

    /* Confetti Effect */
    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: var(--accent-color);
        opacity: 0;
        z-index: 1000;
        animation: confetti-fall 2s ease-out;
    }

    @keyframes confetti-fall {
        0% {
            transform: translateY(-100px) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }

    /* Theme Classes */
    body.soft-pink {
        --background: #fff5f7;
        --sidebar-bg: #f8e1e5;
        --paper-bg: #fffaf0;
        --text-color: #5d4037;
        --accent-color: #e57373;
        --border-color: #d7ccc8;
        --shadow-color: rgba(93, 64, 55, 0.2);
        --doodle-color: #f48fb1;
        --entry-bg: #fff9f9;
        --today-bg: rgba(229, 115, 115, 0.3);
        --event-bg: #fff5f5;
    }

    body.vintage-brown {
        --background: #efebe9;
        --sidebar-bg: #d7ccc8;
        --paper-bg: #f5f5dc;
        --text-color: #4e342e;
        --accent-color: #f48fb1;
        --border-color: #bcaaa4;
        --shadow-color: rgba(78, 52, 46, 0.2);
        --doodle-color: #f48fb1;
        --entry-bg: #f8f4e5;
        --today-bg: rgba(244, 143, 177, 0.3);
        --event-bg: #f5f0e1;
    }

    body.blush-gold {
        --background: #fce4ec;
        --sidebar-bg: #f8bbd0;
        --paper-bg: #fff8e1;
        --text-color: #4e342e;
        --accent-color: #ffb74d;
        --border-color: #ffcc80;
        --shadow-color: rgba(78, 52, 46, 0.2);
        --doodle-color: #ffb74d;
        --entry-bg: #fffbf0;
        --today-bg: rgba(255, 183, 77, 0.3);
        --event-bg: #fff8e8;
    }

    body.dark-chocolate {
        --background: #3e2723;
        --sidebar-bg: #4e342e;
        --paper-bg: #5d4037;
        --text-color: #f8bbd0;
        --accent-color: #f48fb1;
        --border-color: #6d4c41;
        --shadow-color: rgba(0, 0, 0, 0.3);
        --doodle-color: #f48fb1;
        --entry-bg: #6d4c41;
        --today-bg: rgba(244, 143, 177, 0.3);
        --event-bg: #5d4037;
    }

    body.kawaii-pink {
        --background: #fce4ec;
        --sidebar-bg: #f8bbd0;
        --paper-bg: #fff5f7;
        --text-color: #ad1457;
        --accent-color: #f06292;
        --border-color: #f48fb1;
        --shadow-color: rgba(173, 20, 87, 0.2);
        --doodle-color: #f06292;
        --entry-bg: #ffebee;
        --today-bg: rgba(240, 98, 146, 0.3);
        --event-bg: #ffdfe5;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        main {
            flex-direction: column;
        }

        .sidebar {
            width: 100%;
        }

        .calendar-container {
            width: 100%;
        }

        .calendar-header {
            flex-direction: column;
            gap: 15px;
        }

        .date-jump {
            flex-wrap: wrap;
            justify-content: center;
        }

        .form-row {
            flex-direction: column;
            gap: 15px;
        }
    }
</style>
<body class="soft-pink">
<div class="container">
    <header>
        <h1 id="title">My Calendar</h1>
        <div id="date"></div>
    </header>

    <main>
        <div class="sidebar">
            <div class="sidebar-section">
                <h3>Theme</h3>
                <div class="theme-options">
                    <label class="theme-option">
                        <input type="radio" name="theme" value="soft-pink" checked>
                        <span class="theme-preview" style="background: linear-gradient(135deg, #f8e1e5 0%, #fffaf0 100%);"></span>
                        <span class="theme-name">Soft Pink & Cream</span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="vintage-brown">
                        <span class="theme-preview" style="background: linear-gradient(135deg, #d7ccc8 0%, #f5f5dc 100%);"></span>
                        <span class="theme-name">Vintage Brown</span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="blush-gold">
                        <span class="theme-preview" style="background: linear-gradient(135deg, #f8bbd0 0%, #fff8e1 100%);"></span>
                        <span class="theme-name">Blush & Gold</span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="dark-chocolate">
                        <span class="theme-preview" style="background: linear-gradient(135deg, #4e342e 0%, #5d4037 100%);"></span>
                        <span class="theme-name">Dark Chocolate</span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="kawaii-pink">
                        <span class="theme-preview" style="background: linear-gradient(135deg, #f8bbd0 0%, #fff5f7 100%);"></span>
                        <span class="theme-name">Kawaii Pink</span>
                    </label>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Font Style</h3>
                <select id="font-style" class="custom-select">
                    <option value="'Quicksand', sans-serif">Classic</option>
                    <option value="'Dancing Script', cursive">Dancing Script</option>
                    <option value="'Indie Flower', cursive">Indie Flower</option>
                    <option value="'Comic Neue', cursive">Comic Neue</option>
                    <option value="'Pacifico', cursive">Pacifico</option>
                </select>
            </div>

            <div class="sidebar-section">
                <h3>Font Size</h3>
                <input type="range" id="font-size" min="12" max="24" value="16">
                <div id="font-size-display">16px</div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <div class="month-navigation">
                    <button id="prev-month" class="nav-btn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h2 id="month-year">April 2023</h2>
                    <button id="next-month" class="nav-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="date-jump">
                    <input type="date" id="date-picker" aria-label="Jump to date">
                    <button id="today-btn" class="action-btn">Today</button>
                    <button id="add-event-btn" class="action-btn">Add Event</button>
                </div>
            </div>

            <div class="calendar-grid">
                <div class="weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div id="calendar-days" class="days"></div>
            </div>
        </div>
    </main>
</div>

<!-- Event Form Modal -->
<div id="event-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Add New Event</h3>
            <button id="close-modal" class="close-btn">&times;</button>
        </div>
        <form id="event-form">
            <div class="form-group">
                <label for="event-name">Event Name</label>
                <input type="text" id="event-name" required>
            </div>
            <div class="form-group">
                <label for="event-date">Date</label>
                <input type="date" id="event-date" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="event-start">Start Time</label>
                    <input type="time" id="event-start" required>
                </div>
                <div class="form-group">
                    <label for="event-end">End Time</label>
                    <input type="time" id="event-end" required>
                </div>
            </div>
            <div class="form-group">
                <label for="event-color">Color</label>
                <div class="color-options">
                    <input type="radio" name="event-color" id="color-1" value="#f8b0c2" checked>
                    <label for="color-1" class="color-option" style="background-color: #f8b0c2;"></label>

                    <input type="radio" name="event-color" id="color-2" value="#f5d0d9">
                    <label for="color-2" class="color-option" style="background-color: #f5d0d9;"></label>

                    <input type="radio" name="event-color" id="color-3" value="#8d6e63">
                    <label for="color-3" class="color-option" style="background-color: #8d6e63;"></label>

                    <input type="radio" name="event-color" id="color-4" value="#a1887f">
                    <label for="color-4" class="color-option" style="background-color: #a1887f;"></label>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" id="save-event" class="form-btn">Save Event</button>
                <button type="button" id="delete-event" class="form-btn hidden">Delete Event</button>
            </div>
        </form>
    </div>
</div>

<!-- Event Preview Popup -->
<div id="event-preview" class="event-preview">
    <div class="preview-header">
        <h4 id="preview-title"></h4>
        <button id="close-preview" class="close-btn">&times;</button>
    </div>
    <div class="preview-content">
        <p id="preview-time"></p>
    </div>
    <div class="preview-actions">
        <button id="edit-event" class="preview-btn">Edit</button>
        <button id="preview-delete" class="preview-btn">Delete</button>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // DOM Elements
        const calendarDays = document.getElementById("calendar-days");
        const monthYearElement = document.getElementById("month-year");
        const prevMonthBtn = document.getElementById("prev-month");
        const nextMonthBtn = document.getElementById("next-month");
        const datePicker = document.getElementById("date-picker");
        const todayBtn = document.getElementById("today-btn");
        const addEventBtn = document.getElementById("add-event-btn");
        const eventModal = document.getElementById("event-modal");
        const closeModalBtn = document.getElementById("close-modal");
        const eventForm = document.getElementById("event-form");
        const eventNameInput = document.getElementById("event-name");
        const eventDateInput = document.getElementById("event-date");
        const eventStartInput = document.getElementById("event-start");
        const eventEndInput = document.getElementById("event-end");
        const saveEventBtn = document.getElementById("save-event");
        const deleteEventBtn = document.getElementById("delete-event");
        const eventPreview = document.getElementById("event-preview");
        const previewTitle = document.getElementById("preview-title");
        const previewTime = document.getElementById("preview-time");
        const closePreviewBtn = document.getElementById("close-preview");
        const editEventBtn = document.getElementById("edit-event");
        const previewDeleteBtn = document.getElementById("preview-delete");
        const dateDisplay = document.getElementById("date");
        const fontStyleSelect = document.getElementById("font-style");
        const fontSizeInput = document.getElementById("font-size");
        const fontSizeDisplay = document.getElementById("font-size-display");
        const themeOptions = document.querySelectorAll('input[name="theme"]');

        // State
        let currentDate = new Date();
        let events = JSON.parse(localStorage.getItem("calendar-events")) || [];
        let selectedEventId = null;
        let selectedColor = "#f8b0c2";

        // Display current date
        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateDisplay.textContent = new Date().toLocaleDateString('en-US', options);
            monthYearElement.textContent = currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
        }

        // Render calendar
        function renderCalendar() {
            calendarDays.innerHTML = ""; // Clear previous days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            // Fill in empty days before the first day of the month
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement("div");
                emptyDay.classList.add("day", "other-month");
                calendarDays.appendChild(emptyDay);
            }

            // Populate actual days
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement("div");
                dayElement.classList.add("day");

                // Create day number element
                const dayNumber = document.createElement("div");
                dayNumber.classList.add("day-number");
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);

                // Create events container
                const eventsContainer = document.createElement("div");
                eventsContainer.classList.add("events-container");
                dayElement.appendChild(eventsContainer);

                // Check if today
                const currentDayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const isToday = new Date().toDateString() === currentDayDate.toDateString();
                if (isToday) {
                    dayElement.classList.add("today");
                }

                // Add events for this day
                const dayEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getDate() === day &&
                        eventDate.getMonth() === currentDate.getMonth() &&
                        eventDate.getFullYear() === currentDate.getFullYear();
                });

                dayEvents.forEach(event => {
                    const eventElement = document.createElement("div");
                    eventElement.classList.add("event");
                    eventElement.textContent = event.name;
                    eventElement.style.backgroundColor = event.color || "#f8b0c2";
                    eventElement.dataset.eventId = event.id;

                    // Add event listener to show preview
                    eventElement.addEventListener("click", (e) => {
                        e.stopPropagation();
                        showEventPreview(event, e);
                    });

                    eventsContainer.appendChild(eventElement);
                });

                // Add event listener to open modal for adding new event
                dayElement.addEventListener("click", () => {
                    openModal(currentDayDate);
                });

                calendarDays.appendChild(dayElement);
            }

            updateDateDisplay();
        }

        // Navigate months
        prevMonthBtn.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        todayBtn.addEventListener("click", () => {
            currentDate = new Date();
            renderCalendar();
        });

        datePicker.addEventListener("change", () => {
            const [year, month, day] = datePicker.value.split("-").map(Number);
            currentDate = new Date(year, month - 1, day);
            renderCalendar();
        });

        // Open event modal
        function openModal(date = new Date()) {
            eventForm.reset();
            eventDateInput.value = formatDate(date);
            eventModal.classList.add("show");
            eventNameInput.focus();
            selectedEventId = null;
            deleteEventBtn.classList.add("hidden");
            document.getElementById("modal-title").textContent = "Add New Event";
        }

        addEventBtn.addEventListener("click", () => openModal(currentDate));

        // Close modal
        closeModalBtn.addEventListener("click", () => {
            eventModal.classList.remove("show");
        });

        // Save event
        eventForm.addEventListener("submit", (e) => {
            e.preventDefault();
            saveEvent();
        });

        function saveEvent() {
            const name = eventNameInput.value.trim();
            const date = eventDateInput.value;
            const startTime = eventStartInput.value;
            const endTime = eventEndInput.value;
            const color = document.querySelector('input[name="event-color"]:checked').value;

            if (!name) {
                alert("Please enter an event name");
                return;
            }

            if (selectedEventId) {
                // Update existing event
                const eventIndex = events.findIndex(e => e.id === selectedEventId);
                if (eventIndex !== -1) {
                    events[eventIndex] = {
                        ...events[eventIndex],
                        name,
                        date,
                        startTime,
                        endTime,
                        color
                    };
                }
            } else {
                // Add new event
                const newEvent = {
                    id: Date.now().toString(),
                    name,
                    date,
                    startTime,
                    endTime,
                    color
                };
                events.push(newEvent);
            }

            localStorage.setItem("calendar-events", JSON.stringify(events));
            eventModal.classList.remove("show");
            renderCalendar();
        }

        // Show event preview
        function showEventPreview(event, clickEvent) {
            selectedEventId = event.id;
            previewTitle.textContent = event.name;

            let timeText = "";
            if (event.startTime) {
                timeText += `${formatTime(event.startTime)}`;
                if (event.endTime) {
                    timeText += ` - ${formatTime(event.endTime)}`;
                }
            }

            previewTime.textContent = timeText;

            // Position the preview near the clicked element
            const rect = clickEvent.target.getBoundingClientRect();
            eventPreview.style.top = `${rect.bottom + window.scrollY + 10}px`;
            eventPreview.style.left = `${rect.left + window.scrollX}px`;

            // Show the preview
            eventPreview.style.display = "block";
        }

        // Close preview
        closePreviewBtn.addEventListener("click", () => {
            eventPreview.style.display = "none";
        });

        // Edit event
        editEventBtn.addEventListener("click", () => {
            const event = events.find(e => e.id === selectedEventId);
            if (event) {
                eventNameInput.value = event.name;
                eventDateInput.value = event.date;
                eventStartInput.value = event.startTime || "";
                eventEndInput.value = event.endTime || "";

                // Set the color
                const colorRadio = document.querySelector(`input[value="${event.color}"]`);
                if (colorRadio) {
                    colorRadio.checked = true;
                }

                document.getElementById("modal-title").textContent = "Edit Event";
                deleteEventBtn.classList.remove("hidden");
                eventModal.classList.add("show");
                eventPreview.style.display = "none";
            }
        });

        // Delete event
        function deleteEvent() {
            if (selectedEventId) {
                events = events.filter(e => e.id !== selectedEventId);
                localStorage.setItem("calendar-events", JSON.stringify(events));
                eventModal.classList.remove("show");
                eventPreview.style.display = "none";
                renderCalendar();
            }
        }

        deleteEventBtn.addEventListener("click", deleteEvent);
        previewDeleteBtn.addEventListener("click", deleteEvent);

        // Theme handling
        themeOptions.forEach(option => {
            option.addEventListener("change", (e) => {
                document.body.className = e.target.value;
            });
        });

        // Font style handling
        fontStyleSelect.addEventListener("change", (e) => {
            document.body.style.fontFamily = e.target.value;
        });

        // Font size handling
        fontSizeInput.addEventListener("input", (e) => {
            const size = e.target.value;
            fontSizeDisplay.textContent = `${size}px`;
            document.body.style.fontSize = `${size}px`;
        });

        // Utility functions
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours, 10);
            const period = hour >= 12 ? 'PM' : 'AM';
            const formattedHour = hour % 12 || 12;
            return `${formattedHour}:${minutes} ${period}`;
        }

        // Click outside to close
        window.addEventListener("click", (e) => {
            if (e.target === eventModal) {
                eventModal.classList.remove("show");
            }

            if (!eventPreview.contains(e.target) && e.target.className !== "event") {
                eventPreview.style.display = "none";
            }
        });

        // Initial render
        updateDateDisplay();
        renderCalendar();
    });
</script>
</body>
</html>
